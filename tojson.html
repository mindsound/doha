<!DOCTYPE html>
<html>
<head>
<title>DOHA Scraper</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript">

$(function(){

  var pages = [];

  // load page contents into invisible divs
  for (year = 1996; year <= 2015; year++) {
    var url = 'scrape/' + year + '.html';
    pages.push($.get(url));
  }

  $.when.apply($, pages).done(function() {

    // push everything to a hidden div so we can iterate over everything at once
    $.each(arguments, function(ii, data) {
      $('#data').append("<div id='response-" + ii + "' style='display:none;'></div>");
      var responseBody = data[0];
      $('#response-' + ii).append($(responseBody).filter('.case-list'));
    });

    // slurp invisible divs to produce JSON
    var cases = [];
    $('.case').each(function(ii, caseData){

      // TODO: don't push caseData, build an object from selectors on caseData and push that
      cases.push(caseData);
    });

    $('#output').append('<pre>' + JSON.stringify(cases, null, 2) + '</pre>');

  });
});

</script>
</head>

<body>
  <div id="data" style="display: none;"></div>
  <div id="output"></div>
</body>


</html>
